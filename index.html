<script src="https://d3js.org/d3.v4.min.js"></script>
<script type="text/javascript" src="https://rawgithub.com/NickQiZhu/dc.js/master/web/js/crossfilter.js"></script>
<head>
<link rel="icon" href="data:;base64,=">
</head>

<style>

 #div1{
   width: 1300px;
   display: block;
   padding-left: 300px;
 }
#line_div{padding-left: 40px;
padding right: 20px;
width: 960px;
display: block;}
#keydiv{
 padding-left: 40px;
 padding right: 20px;
 width: 960px;
 display: block;

}
 .key_label{
   float: left;
   display: float;
   width: 100px;



 }
  .axis path, line{
        stroke:black;
    }



    .key_square{
       margin-left:50px;
        height:10px;
        width:10px;
        outline:solid 1px black;
        float:left;
		     margin: 6px 10px 0px 10px;
    }
    #bar_div{
      height: 400px;
      width:900px;
    }
    #scatter{
        float:left;
    }


</style>
<script>

var time_scale,
    percent_scale,
    cost_scale,
    month_scale;
var filtered_data=[];
var agg_filter=[];
var groups=[{'id':'BTC','desc':'Bitcoin'},{'id':'LTC','desc':'LiteCoin'},{'id':'ETH','desc':'Etherium'},{'id':'XRP','desc':'XRP'},{'id':'SENT','desc':'Sentiment'}];

function getcolor(id){
  if (id=='BTC'){
    color="#fb5454";
  }
  if (id=='LTC'){
    color="#f1fb54";
  }
  if (id=='ETH'){
    color="#54befb";
  }
  if (id=='XRP'){
    color="#fffff";
  }
  if (id=='SENT'){
    color="#000000";
  }

  return color
}
var color = d3.scaleOrdinal()
   //this assumes you have 3 groups of data//ï»¿each of the domains corresponds to a color set
       .domain(['BTC','LTC','ETH','XRP','SENT'])
       .range(["#fb5454", "#f1fb54", "#54befb","#fffff","#000000"]);


function gen_legend(data){
  var key_items = d3.select("#key_div")
    .selectAll("div")
    .data(groups)
    .enter()
  .append("div")
    .attr("class","key_line")
    .attr("height",20)
    .attr("width",300)
    .attr("id",function(d){return d.id});

  key_items.append("div")
      .attr("id", function(d){return "key_square_" + d.id})
      .style('background-color', function (d) { return color(d.id) })
      .attr("class", "key_square");

  key_items.append("div")
      .attr("class","key_label")
      .text(function(d){return d.desc});

  d3.selectAll(".key_line")
                .on("click", get_data);
  }



function draw_linechart(){
  container_dimensions = {width: 900, height: 400},
  margins = {top: 10, right: 20, bottom: 30, left: 60},
  chart_dimensions = {
      width: container_dimensions.width - margins.left - margins.right,
      height: container_dimensions.height - margins.top - margins.bottom
    };


  var chart = d3.select("#line_div")
      .append("svg")
        .attr("width", container_dimensions.width)
        .attr("height", container_dimensions.height)
      .append("g")
        .attr("transform", "translate(" + margins.left + "," + margins.top + ")")
        .attr("id","linechart");

  var start = d3.timeParse("%m/%d/%Y %H:%M %p")("9/14/2017 8:00 AM");
  var end=d3.timeParse("%m/%d/%Y %H:%M %p")("9/17/2017 12:00 PM");
  console.log(start)

    time_scale =  d3.scaleTime()
      .range([0,chart_dimensions.width])
      .domain([start, end]);

    percent_scale = d3.scaleLinear()
      .range([chart_dimensions.height, 0])
      .domain([-0.5,.5]);

    var time_axis = d3.axisBottom(time_scale);

    var count_axis = d3.axisLeft(percent_scale);

    chart.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + chart_dimensions.height + ")")
      .call(time_axis);

  chart.append("g")
	   .attr("class", "y axis")
	    .call(count_axis);

  d3.select(".y.axis")
    .append("text")
	   .attr("text-anchor","middle")
      .text("percent on time")
    .attr("transform", "rotate (-270, 0, 0)")
    .attr("x",  container_dimensions.height/2)
    .attr("y", 50);
      };



function get_data(){
  // get the id of the current element
  var id = d3.select(this).attr("id");
  // see if we have an associated time series

  var ts = d3.selectAll("#"+id+"_path");

  if (ts.empty()) {
      d3.csv("cryptodata.csv", function(data){
        var parseDate = d3.timeParse("%m/%d/%Y %H:%M");

        data.forEach(function(d) {
          d.datetime_s=d.datetime
           d.datetime=parseDate(d.datetime);
           d.wtgsent= +d.wtgsent;
           d.pricech= +d.pricech;
          });


          filtered_data = data.filter(function(d){return d.id === id;});
          console.log('data')
          console.log(filtered_data)
          plot_linechart(id);
      })}
    else {
          ts.remove();

      };
  }


function plot_linechart(id){
    var color=getcolor(id);
    console.log(color);
    var line = d3.line()
      .x(function(d) { return time_scale(d.datetime); })
      .y(function(d) { return percent_scale(d.pricech); });

      var g = d3.select("#linechart")
          .append("g")
              .attr("id", id + "_path")
              .attr("class", id.split("_"));
              // draw dots
      g.append("path")
              .datum(filtered_data)
              .attr("fill", "none")
              .attr("stroke", color)
              .attr("stroke-linejoin", "round")
              .attr("stroke-linecap", "round")
              .attr("stroke-width", 1)
              .attr("d", line);

      }




</script>

<body>
    <h1>Cryptocurrencies</h1>
    <h2>Background</h2>
    <div id='intro' class='text'>
    <p>Cryptocurrencies are a type of digital currency that work as a medium of exchange. The most commonly known cryptocurrency is Bitcoin
      which was created in 2009. Cryptocurrencies have decentralized control which work use blockchain. Blockchain is a type of cryptography which
      allows for secure transactions to control the creation of units and verify the transfer of assets(source: https://en.wikipedia.org/wiki/Cryptocurrency).
    </p>
    <p>Over the past year, cryptocurrencies have undergone a surge in popularity. The graphic below daily volume traded for numerous cryptocurrencies.
      As you can see, a significant surge in trading began in late may and this uptick has continued on.
    </p>
    </div>
    <div id='streamgraph'>
     <img src="img/streamgraph_total.png" alt="Streamgraph">
    </div>
    <h2>Twitter</h2>
    <div id='twittertxt' class='text'>
    <p>
    blah blah twitter blah blah tweets blah  blah blah twitter blah blah tweets blah  blah blah twitter
    blah blah tweets blah  blah blah twitter blah blah tweets blah
    blah blah twitter blah blah tweets blah
    </p>
    </div>
    <div id='twittervis'>
      <img src="img/radial_graph_morning.png" alt="S">
      <img src="img/radial_graph_evening.png" alt="">
      <img src="img/doughnut_chart.png" alt="Doughnut chart of hashtags-refer to 'doughtnut.html' for code">

    </div>
    <div id='linetxt' class='text'>
    <p>
    Recently cryptocurrencies have been covered as topic pieces in the mainstream media but day to day market fluctuations
    are not covered to the same degree as their regulated financial market counterparts. As such, information gathering\
    can be challening. Our group was interested exploring the relationship between cryptocurrency valuation
    and information gathering via twitter.
    </p>
    </div>
    <h2>Sentiment Analysis</h2>
    <div id='sent'>
    <div id="key_div"></div>
    <div id="line_div"></div>
    </div>



    <script>
      gen_legend();
      draw_linechart();




  </script>
</body>
</script>
